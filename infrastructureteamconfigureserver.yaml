---
- name: Create Inventory
  hosts: messageserver

  tasks:
    - name: "Create Dynamic inventory for new server"
      add_host:
        hostname: "{{infrakafkamessage.VM_IP}}"
        groupname: "newvm"

- name: Configure Server
  hosts: newvm
  tasks:
    - name: "Register to Red Hat Subscription"
      community.general.redhat_subscription:
        state: present
        username: "{{infrateam_rh_username}}"
        password: "{{infrateam_rh_password}}"
        auto_attach: true
    
    - name: "Install Web server package"
      ansible.builtin.dnf:
        name: "httpd"
        state: present
      when: infrakafkamessage.VM_TYPE == "webserver"

    - name: "Install Database server package"
      ansible.builtin.dnf:
        name: "postgresql-server"
        state: present
      when: infrakafkamessage.VM_TYPE == "dbserver"
      
